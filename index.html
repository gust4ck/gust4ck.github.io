<!DOCTYPE html>
<html lang="auto">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FocusCounter | your time</title>
  <meta name="description" content="Minimalist counter to focus your time on activities.">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
    crossorigin="anonymous"></script>
  <style>
    :root {
      --bg: #000;
      --text: #fff;
      --border: #333;
      --primary: #fff;
      --card: #111;
    }

    [data-theme="light"] {
      --bg: #fff;
      --text: #000;
      --border: #ddd;
      --primary: #000;
      --card: #f5f5f5;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Roboto Mono', monospace;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      transition: background 0.3s ease;
    }

    .timer-display {
      font-size: min(25vw, 140px);
      font-weight: 500;
      margin-bottom: 30px;
      font-variant-numeric: tabular-nums;
      letter-spacing: -3px;
      text-align: center;
      padding: 10px;
    }

    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 30px;
    }

    .btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--primary);
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn:active {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn-primary {
      background: var(--primary);
      color: var(--bg);
      border: none;
    }

    .btn:disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .icon {
      font-size: 24px;
    }

    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    footer {
      position: fixed;
      bottom: 16px;
      font-size: 11px;
      color: var(--border);
      letter-spacing: 0.5px;
    }

    /* Popup de anúncio */
    .ad-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      max-width: 300px;
      width: 90%;
      text-align: center;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      display: none;
    }

    .ad-popup p {
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .ad-popup .ad-message {
      margin-bottom: 15px;
      font-size: 14px;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 999;
      display: none;
    }

    .ad-container {
      width: 100%;
      margin: 15px 0;
      min-height: 100px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 10px;
    }

    .countdown {
      font-weight: bold;
      color: var(--primary);
      font-size: 15px;
    }

    @media (max-width: 500px) {
      .timer-display {
        font-size: 25vw;
      }

      .btn {
        width: 48px;
        height: 48px;
      }

      .ad-popup {
        padding: 15px;
      }
    }
  </style>
</head>

<body>
  <div class="theme-toggle" id="themeToggle">
    <span class="material-icons" id="themeIcon">dark_mode</span>
  </div>

  <div class="timer-display" id="timerDisplay">
    <span id="hoursDisplay">00</span>:<span id="minutesDisplay">00</span>:<span id="secondsDisplay">00</span>
  </div>

  <div class="controls">
    <button class="btn btn-primary" id="startBtn">
      <span class="material-icons icon">play_arrow</span>
    </button>
    <button class="btn" id="stopBtn" disabled>
      <span class="material-icons icon">pause</span>
    </button>
    <button class="btn" id="resetBtn">
      <span class="material-icons icon">replay</span>
    </button>
  </div>

  <footer id="footer">FOCUSCOUNTER</footer>

  <!-- Popup de anúncio -->
  <div class="overlay" id="overlay"></div>
  <div class="ad-popup" id="adPopup">
    <p class="ad-message" id="adMessage1"></p>
    <p class="ad-message" id="adMessage2"></p>
    <p id="adCountdownText"></p>
    <div class="ad-container">
      <!-- AdSense -->
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    </div>
  </div>

  <script>
    // Serviço de tradução automática
    class Translator {
      constructor() {
        this.languages = {
          'en': {
            title: 'FocusCounter | Infinite Counter',
            description: 'Minimalist infinite counter for focus',
            adMessage1: "We won't clutter your screen. We just need 1 ad to keep the site alive.",
            adMessage2: "After this ad, no others will appear during your use of the site.",
            adCountdownText: 'The ad will close automatically in:',
            footer: 'FOCUSCOUNTER',
            themeIcon: {
              dark: 'dark_mode',
              light: 'light_mode'
            }
          }
        };

        // Idiomas adicionais serão carregados dinamicamente
        this.currentLanguage = 'en';
        this.userLanguage = this.getBrowserLanguage();
      }

      async detectLanguage() {
        try {
          // 1. Primeiro tenta pegar a localização por IP
          const ipResponse = await fetch('https://ipapi.co/json/');
          const ipData = await ipResponse.json();
          const countryCode = ipData.country ? ipData.country.toLowerCase() : null;

          // Mapeamento de códigos de país para idiomas
          const countryToLanguage = {
            'br': 'pt', 'pt': 'pt', 'ao': 'pt', 'mz': 'pt', // Português
            'es': 'es', 'mx': 'es', 'ar': 'es', 'co': 'es', // Espanhol
            'it': 'it', 'ch': 'it', // Italiano
            'fr': 'fr', 'be': 'fr', 'ca': 'fr', // Francês
            'de': 'de', 'at': 'de', 'ch': 'de', // Alemão
            'ru': 'ru', 'ua': 'ru', 'by': 'ru', // Russo
            'cn': 'zh', 'tw': 'zh', 'hk': 'zh', // Chinês
            'jp': 'ja', // Japonês
            'kr': 'ko', // Coreano
            'in': 'hi', // Hindi
            'sa': 'ar', 'ae': 'ar', 'eg': 'ar', // Árabe
            // Adicione mais mapeamentos conforme necessário
          };

          // Verifica se temos um idioma para o país
          if (countryCode && countryToLanguage[countryCode]) {
            this.currentLanguage = countryToLanguage[countryCode];
          }
          // 2. Se não, usa o idioma do navegador
          else if (this.userLanguage) {
            this.currentLanguage = this.userLanguage;
          }

          // Carrega traduções se necessário
          await this.loadTranslations();

        } catch (error) {
          console.error("Error detecting language:", error);
          // Fallback para inglês
          this.currentLanguage = 'en';
        }
      }

      getBrowserLanguage() {
        // Pega o idioma principal do navegador (ex: 'pt' de 'pt-BR')
        const lang = navigator.language || navigator.userLanguage;
        return lang.split('-')[0].toLowerCase();
      }

      async loadTranslations() {
        // Se já temos tradução para esse idioma, não precisa carregar
        if (this.languages[this.currentLanguage]) return;

        try {
          // Tenta carregar tradução do arquivo de idioma
          const response = await fetch(`https://cdn.jsdelivr.net/gh/andreknieriem/simple-translator@master/langs/${this.currentLanguage}.json`);
          const translations = await response.json();

          // Adiciona ao nosso dicionário de idiomas
          this.languages[this.currentLanguage] = translations;
        } catch (error) {
          console.error(`Failed to load translations for ${this.currentLanguage}:`, error);
          // Fallback para inglês se não conseguir carregar traduções
          this.currentLanguage = 'en';
        }
      }

      translate(key) {
        // Retorna a tradução ou o texto em inglês se não encontrar
        const lang = this.languages[this.currentLanguage] || this.languages['en'];
        return lang[key] || this.languages['en'][key] || key;
      }

      applyTranslations() {
        // Atualiza metatags
        document.title = this.translate('title');
        document.querySelector('meta[name="description"]').content = this.translate('description');

        // Atualiza textos
        document.getElementById('adMessage1').textContent = this.translate('adMessage1');
        document.getElementById('adMessage2').textContent = this.translate('adMessage2');
        document.getElementById('adCountdownText').innerHTML = this.translate('adCountdownText') + ' <span class="countdown" id="countdown">30</span>';
        document.getElementById('footer').textContent = this.translate('footer');

        // Atualiza ícone do tema
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
        const themeIcon = document.getElementById('themeIcon');
        themeIcon.textContent = currentTheme === 'dark'
          ? this.translate('themeIcon.dark')
          : this.translate('themeIcon.light');
      }
    }

    class FocusCounter {
      constructor() {
        this.seconds = 0;
        this.mainInterval = null;
        this.isRunning = false;
        this.adCountdown = 30;
        this.adInterval = null;
        this.translator = new Translator();

        this.initApp();
      }

      async initApp() {
        await this.translator.detectLanguage();
        this.translator.applyTranslations();

        this.initElements();
        this.initEvents();
        this.loadSettings();
        this.updateDisplay();
        this.showAdPopup();
      }

      initElements() {
        this.timerDisplay = document.getElementById('timerDisplay');
        this.hoursDisplay = document.getElementById('hoursDisplay');
        this.minutesDisplay = document.getElementById('minutesDisplay');
        this.secondsDisplay = document.getElementById('secondsDisplay');

        this.startBtn = document.getElementById('startBtn');
        this.stopBtn = document.getElementById('stopBtn');
        this.resetBtn = document.getElementById('resetBtn');

        this.themeToggle = document.getElementById('themeToggle');
        this.themeIcon = document.getElementById('themeIcon');

        this.adPopup = document.getElementById('adPopup');
        this.overlay = document.getElementById('overlay');
        this.countdownDisplay = document.getElementById('countdown');
      }

      initEvents() {
        this.startBtn.addEventListener('click', () => this.start());
        this.stopBtn.addEventListener('click', () => this.stop());
        this.resetBtn.addEventListener('click', () => this.reset());
        this.themeToggle.addEventListener('click', () => this.toggleTheme());

        document.addEventListener('keydown', (e) => {
          if (e.code === 'Space') {
            e.preventDefault();
            this.isRunning ? this.stop() : this.start();
          }
          if (e.code === 'Escape') {
            this.reset();
          }
        });
      }

      showAdPopup() {
        this.adPopup.style.display = 'block';
        this.overlay.style.display = 'block';

        // Inicia a contagem regressiva do anúncio
        this.startAdCountdown();

        // Carrega o anúncio do Google AdSense
        (adsbygoogle = window.adsbygoogle || []).push({});
      }

      startAdCountdown() {
        this.adCountdown = 30;
        this.updateAdCountdown();

        // Limpa qualquer intervalo anterior para evitar múltiplas instâncias
        if (this.adInterval) clearInterval(this.adInterval);

        this.adInterval = setInterval(() => {
          this.adCountdown--;
          this.updateAdCountdown();

          if (this.adCountdown <= 0) {
            this.closeAdPopup();
          }
        }, 1000);
      }

      updateAdCountdown() {
        this.countdownDisplay.textContent = this.adCountdown;
      }

      closeAdPopup() {
        clearInterval(this.adInterval);
        this.adPopup.style.display = 'none';
        this.overlay.style.display = 'none';
      }

      start() {
        if (this.isRunning) return;

        this.isRunning = true;
        this.updateButtonStates();

        this.mainInterval = setInterval(() => {
          this.seconds++;
          this.updateDisplay();
        }, 1000);
      }

      stop() {
        if (!this.isRunning) return;

        clearInterval(this.mainInterval);
        this.isRunning = false;
        this.updateButtonStates();
      }

      reset() {
        this.stop();
        this.seconds = 0;
        this.updateDisplay();
      }

      updateButtonStates() {
        this.startBtn.disabled = this.isRunning;
        this.stopBtn.disabled = !this.isRunning;
      }

      updateDisplay() {
        const hours = Math.floor(this.seconds / 3600);
        const mins = Math.floor((this.seconds % 3600) / 60);
        const secs = this.seconds % 60;

        this.hoursDisplay.textContent = this.pad(hours);
        this.minutesDisplay.textContent = this.pad(mins);
        this.secondsDisplay.textContent = this.pad(secs);
      }

      pad(num) {
        return num.toString().padStart(2, '0');
      }

      toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        document.documentElement.setAttribute('data-theme', newTheme);
        this.themeIcon.textContent = newTheme === 'dark'
          ? this.translator.translate('themeIcon.dark')
          : this.translator.translate('themeIcon.light');

        localStorage.setItem('fc_theme', newTheme);
      }

      loadSettings() {
        const savedTheme = localStorage.getItem('fc_theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        this.themeIcon.textContent = savedTheme === 'dark'
          ? this.translator.translate('themeIcon.dark')
          : this.translator.translate('themeIcon.light');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const app = new FocusCounter();
    });
  </script>
</body>

</html>
